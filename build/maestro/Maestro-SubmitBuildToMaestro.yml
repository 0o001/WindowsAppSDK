parameters:
  AssetName: ''
  AssetVersion: ''
  nonShipping: true
steps:
  - task: PowerShell@2
    displayName: Build JsonBody 
    inputs:
      targetType: 'inline'
      script: |
        $jsonBase = @{}

        $assetList = New-Object System.Collections.ArrayList
        $assetList.Add(@{"name"="${{ parameters.AssetName }}";"version"="${{ parameters.AssetVersion }}";"nonShipping"="${{ parameters.nonShipping }}"})
        $assets = @{"assets"=$assetList;}
        $jsonBase.Add($assets)
        $jsonBase | ConvertTo-Json -Depth 10 | Out-File '$(Build.SourcesDirectory)\build\maestro\maestro-build.json'
        $body = Get-Content -Raw -Path '$(Build.SourcesDirectory)\build\maestro\maestro-build.json'
        Write-host $body

  - task: powershell@2
    displayName: 'Post Channel Test'
    inputs:
      targetType: filePath
      filePath: build\maestro\SubmitBuildToMaestro.ps1
      arguments: -Uri '$(MaestroUri)' -Token '$(MaestroToken)' -JsonPath '$(Build.SourcesDirectory)\build\maestro\maestro-build.json'