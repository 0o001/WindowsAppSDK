parameters:
- name: "publishToMaestro"
  type: boolean
  default: False
- name: "IgnoreFailures"
  type: boolean
  default: False
- name: "SignOutput"
  type: boolean
  default: False

stages:
- stage: TransportPackage
  jobs:
  - job: BuildBinaries
    pool:
      # read more about custom job pool types at https://aka.ms/obpipelines/yaml/jobs
      type: windows
    strategy:
      maxParallel: 10
      matrix:
        Release_x86:
          buildPlatform: 'x86'
          buildConfiguration: 'Release'
          normalizedConfiguration: 'fre'
          PGOBuildMode: 'Optimize'
        Release_x64:
          buildPlatform: 'x64'
          buildConfiguration: 'Release'
          normalizedConfiguration: 'fre'
          PGOBuildMode: 'Optimize'
        Release_Arm64:
          buildPlatform: 'arm64'
          buildConfiguration: 'Release'
          normalizedConfiguration: 'fre'
    variables:
      # binaries scanning tools are run on this directory ( https://onebranch.visualstudio.com/OneBranch/_wiki/wikis/OneBranch.wiki/4634/SDL-(Static-Analysis)-for-Containerized-Workflows ) and
      # this directory is uploaded to pipeline artifacts. More info at https://aka.ms/obpipelines/artifacts
      ob_outputDirectory: '$(REPOROOT)\out'
      ob_sdl_codeSignValidation_excludes: '-|**\TestingArtifact\**;-|**\BuildOutput\**'
      ob_artifactSuffix: '_$(buildConfiguration)$(buildPlatform)'
    steps:
    - template: WindowsAppSDK-BuildBinaries-Steps.yml@self
      parameters:
        SignOutput: ${{ parameters.SignOutput }}
